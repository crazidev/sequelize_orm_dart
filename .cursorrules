# Sequelize Dart Project Rules

You are working on Sequelize Dart, a Dart ORM that wraps Sequelize.js with dual platform support (Dart VM via Node.js bridge, dart2js via JS interop).

## Quick Reference

- **Documentation**: See `.ai/` folder for detailed guides
- **Main ORM package**: `packages/sequelize_dart/`
- **Annotations**: `packages/sequelize_dart_annotations/`
- **Generator**: `packages/sequelize_dart_generator/`
- **Bridge server**: `packages/sequelize_dart/js/`
- **Example**: `example/`
- **Tests**: `test/`

## Key Architecture Points

1. **Platform conditional exports**: Files use `_dart.dart`, `_js.dart`, `_stub.dart` pattern
2. **Generated code**: Models generate `$ClassName`, `$ClassNameValues`, `$ClassNameColumns`
3. **Bridge communication**: JSON-RPC over stdin/stdout between Dart VM and Node.js
4. **Query operators**: Extensions on `Column<T>` returning `ComparisonOperator`

## When Adding Features

### New Query Method
1. Add to `query_engine_interface.dart`
2. Implement in `query_engine_dart.dart` (bridge)
3. Implement in `query_engine_js.dart` (JS interop)
4. Create handler in `js/src/handlers/`
5. Register in `bridge_server.ts`
6. Create generator in `generators/methods/`
7. Add test

### New Operator
1. Add extension in `operators/extentions/`
2. Add to `_getOpSymbol()` in `query_engine_js.dart`
3. Add to `convertWhereClause()` in `queryConverter.ts`
4. Add test

## Commands

```bash
# Build bridge
./tools/setup_bridge.sh

# Generate models
cd example && dart run build_runner build --delete-conflicting-outputs

# Run tests
dart test

# Format code
./tools/format.sh
```

## Code Style

- Dart: 80 char lines, trailing commas, `final` over `var`
- TypeScript: Prettier, single quotes, semicolons
- Follow existing patterns in the codebase
