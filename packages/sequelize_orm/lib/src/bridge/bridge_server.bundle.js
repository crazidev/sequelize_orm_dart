#!/usr/bin/env node
var C=require("worker_threads");function K(e){let o=e?.message||e?.toString?.()||"Unknown error",r=e?.name||e?.constructor?.name||"Error",i=e?.code||e?.statusCode||-32603,t=e?.stack||"",n={name:r,message:o,code:i,stack:t};return e?.original&&(n.original={message:e.original.message||e.original.toString?.(),code:e.original.code}),e?.sql&&(n.sql=e.sql),n}var v=null,U=new Map,T={hoistIncludeOptions:!1,dialect:"postgres",normalizeJsonTypes:!0},$=null;function E(e){$=e}function F(e){$&&$(e)}function q(){return T}function V(e){T={...T,...e}}function l(){return v}function G(e){v=e}function u(){return U}function _(){v&&(v=null),U.clear()}async function Q(){return{ready:!0}}var j=require("@sequelize/core");function W(e){switch(e){case"postgres":return require("@sequelize/postgres").PostgresDialect;case"mysql":return require("@sequelize/mysql").MySqlDialect;case"mariadb":return require("@sequelize/mariadb").MariaDbDialect;case"sqlite":return require("@sequelize/sqlite3").SqliteDialect;default:return require("@sequelize/postgres").PostgresDialect}}function ze(e){let o="$";for(let r of e)typeof r=="number"?o+=`[${r}]`:/^[a-z_][a-z0-9_]*$/i.test(r)?o+=`.${r}`:o+=`."${r.replace(/["\\]/g,i=>`\\${i}`)}"`;return o}function H(e){let o=e.dialect;if(!o||!o.name?.startsWith("sqlite"))return;let r=o.constructor.supports;r&&(r.jsonOperations=!0,r.jsonExtraction?(r.jsonExtraction.unquoted=!0,r.jsonExtraction.quoted=!0):r.jsonExtraction={unquoted:!0,quoted:!0});let i=e.queryGenerator;if(!i)return;let t=Object.getPrototypeOf(i);t.jsonPathExtractionQuery=function(n,a,c){let s=ze(a);return c?`${n} ->> ${this.escape(s)}`:`${n} -> ${this.escape(s)}`},t.formatUnquoteJson=function(n,a){return`${this.escape(n,a)} ->> '$'`}}async function Y(e){let o=e.config,{logging:r,dialect:i,pool:t,hoistIncludeOptions:n,normalizeJsonTypes:a,...c}=o,s=typeof i=="string"?i.toLowerCase():"postgres";V({hoistIncludeOptions:!!n,dialect:s,normalizeJsonTypes:a!==!1});let h={};t&&(t.max!==void 0&&t.max!==null&&(h.max=t.max),t.min!==void 0&&t.min!==null&&(h.min=t.min),t.idle!==void 0&&t.idle!==null&&(h.idle=t.idle),t.acquire!==void 0&&t.acquire!==null&&(h.acquire=t.acquire),t.evict!==void 0&&t.evict!==null&&(h.evict=t.evict));let k=r?y=>{F({notification:"sql_log",sql:typeof y=="string"?y:String(y)})}:!1,M={...c,dialect:W(i),logging:k};s!=="postgres"&&(M.define={...M.define||{},schema:void 0}),Object.keys(h).length>0&&(M.pool=h);let z=new j.Sequelize(M);function w(y){let R=y?.original??y?.parent??y,I=R?.errno??R?.errno,O=R?.code;return I===1049||O==="ER_BAD_DB_ERROR"}async function P(){if(s!=="mysql"&&s!=="mariadb")return!1;let y=typeof c.database=="string"?c.database:typeof c.url=="string"?(()=>{try{return(new URL(c.url).pathname?.replace(/^\//,"")??"")||void 0}catch{return}})():void 0;if(!y)return!1;let R={...M};if(typeof c.url=="string")try{let O=new URL(c.url);O.pathname="/",O.search="",O.hash="",R={...R,url:O.toString()}}catch{}R.database=void 0;let I=new j.Sequelize(R);try{return await I.authenticate(),await I.query(`CREATE DATABASE IF NOT EXISTS \`${y}\``),!0}finally{await I.close().catch(()=>{})}}try{await z.authenticate()}catch(y){if(w(y))if(await P())await z.authenticate();else throw y;else throw y}return H(z),G(z),{connected:!0}}var g=require("@sequelize/core");var Pe={STRING:g.DataTypes.STRING,CHAR:g.DataTypes.CHAR,TEXT:g.DataTypes.TEXT,TINYINT:g.DataTypes.TINYINT,SMALLINT:g.DataTypes.SMALLINT,MEDIUMINT:g.DataTypes.MEDIUMINT,INTEGER:g.DataTypes.INTEGER,BIGINT:g.DataTypes.BIGINT,FLOAT:g.DataTypes.FLOAT,DOUBLE:g.DataTypes.DOUBLE,DECIMAL:g.DataTypes.DECIMAL,BOOLEAN:g.DataTypes.BOOLEAN,DATE:g.DataTypes.DATE,DATEONLY:g.DataTypes.DATEONLY,UUID:g.DataTypes.UUID,JSON:g.DataTypes.JSON,JSONB:g.DataTypes.JSONB,BLOB:g.DataTypes.BLOB,NOW:g.DataTypes.NOW};function Ie(e){let o=q(),r=o.dialect;r==="sqlite"&&e.type==="BIGINT"&&(e={...e,type:"INTEGER"}),o.normalizeJsonTypes!==!1&&(r==="postgres"&&e.type==="JSON"?e={...e,type:"JSONB"}:(r==="mysql"||r==="mariadb")&&e.type==="JSONB"&&(e={...e,type:"JSON"}));let i=Pe[e.type];if(!i)throw new Error(`Unknown data type: ${e.type}`);let t=i,n=typeof e.length=="number",a=typeof e.scale=="number";return typeof e.variant=="string"&&e.variant.length>0&&(e.type==="TEXT"||e.type==="BLOB")?t=i(e.variant):n&&a?t=i(e.length,e.scale):n&&(t=i(e.length)),e.unsigned&&t?.UNSIGNED&&(t=t.UNSIGNED),e.zerofill&&t?.ZEROFILL&&(t=t.ZEROFILL),e.binary&&t?.BINARY&&(t=t.BINARY),t}function ve(e){let o={type:Ie(e)};return e.primaryKey!==void 0&&e.primaryKey!==null&&(o.primaryKey=e.primaryKey),e.autoIncrement!==void 0&&e.autoIncrement!==null&&(o.autoIncrement=e.autoIncrement),e.autoIncrementIdentity!==void 0&&e.autoIncrementIdentity!==null&&(o.autoIncrementIdentity=e.autoIncrementIdentity),o.allowNull=e.allowNull!==void 0?e.allowNull:!0,e.defaultValue!==void 0&&e.defaultValue!==null&&(o.defaultValue=e.defaultValue),e.columnName!==void 0&&e.columnName!==null&&(o.field=e.columnName),e.unique!==void 0&&e.unique!==null&&(o.unique=e.unique),e.comment!==void 0&&e.comment!==null&&(o.comment=e.comment),e.validate!==void 0&&e.validate!==null&&(o.validate=e.validate),o}function X(e){let o=[];for(let[r,i]of Object.entries(e))if(i.index!==void 0&&i.index!==null){if(i.index===!0)o.push({fields:[r]});else if(typeof i.index=="string"){let t=o.find(n=>n.name===i.index);t?t.fields.push(r):o.push({name:i.index,fields:[r]})}else if(typeof i.index=="object"){let t={fields:[r]};if(i.index.name){let n=o.find(a=>a.name===i.index.name);n?n.fields.push(r):(t.name=i.index.name,o.push(t))}else o.push(t)}}return o}function Z(e){let o={};for(let[r,i]of Object.entries(e))o[r]=ve(i);return o}async function ee(e){let o=l();if(!o)throw new Error("Not connected. Call connect first.");let{name:r,attributes:i,options:t}=e,n=Z(i),a=X(i),c={...t||{}};a.length>0&&(c.indexes=[...c.indexes||[],...a]);let s=u(),h=o.define(r,n,c);return s.set(r,h),{defined:!0,primaryKeys:h.primaryKeyAttributes||[]}}function oe(e){if(!e||typeof e!="object")return{};let o={};for(let[r,i]of Object.entries(e))i!=null&&(o[r]=i);return o}async function ne(e){let o=u(),{sourceModel:r,targetModel:i,associationType:t}=e,n=o.get(r),a=o.get(i);if(!n)throw new Error(`Source model "${r}" not found. Define it first.`);if(!a)throw new Error(`Target model "${i}" not found. Define it first.`);let c=oe(e.options),s=c.as;if(s&&n.associations?.[s])return{associated:!0};switch(t){case"hasOne":n.hasOne(a,c);break;case"hasMany":n.hasMany(a,c);break;case"belongsTo":n.belongsTo(a,c);break;default:throw new Error(`Unknown association type: ${t}`)}return{associated:!0}}function m(e){if(!e)throw new Error("Not connected. Call connect first.")}function f(e,o){if(!e)throw new Error(`Model "${o}" not found. Define it first.`)}var d=require("@sequelize/core");function b(e){if(!e||typeof e!="object")return e;if(e.__type){let o;switch(e.__type){case"fn":o=d.sql.fn(e.fn,...(e.args||[]).map(r=>b(r)));break;case"col":o=d.sql.col(e.col);break;case"literal":o=d.sql.literal(e.value);break;case"attribute":o=d.sql.attribute(e.attribute);break;case"identifier":o=d.sql.identifier(e.identifier);break;case"cast":o=d.sql.cast(b(e.expression),e.type);break;case"random":o=typeof d.Sequelize.random=="function"?d.Sequelize.random():d.sql.fn("RANDOM");break;default:return console.warn(`[JS Bridge] Unknown SQL expression type: ${e.__type}`),e}return o}return Array.isArray(e)?e.map(o=>b(o)):e}function Ce(e){if(!e.include)return;function o(r,i=[]){let t=Array.isArray(r)?r:[r];for(let n of t){if(!n||typeof n!="object")continue;let a=n.as||n.association;if(!a)continue;let c=[...i,a];if(n.order&&!n.separate){e.order||(e.order=[]),Array.isArray(e.order)||(e.order=[e.order]);let s=n.order;(Array.isArray(s)&&s.length===2&&typeof s[1]=="string"&&(s[1].toUpperCase()==="ASC"||s[1].toUpperCase()==="DESC")||!Array.isArray(s))&&(s=[s]);for(let k of s)Array.isArray(k)?e.order.push([...c,...k]):e.order.push([...c,k]);delete n.order}if(n.group&&!n.separate){e.group||(e.group=[]),Array.isArray(e.group)||(e.group=[e.group]);let s=n.group;Array.isArray(s)||(s=[s]);for(let h of s)Array.isArray(h)?e.group.push([...c,...h]):e.group.push([...c,h]);delete n.group}n.include&&o(n.include,c)}}o(e.include)}function x(e){if(!e||typeof e!="object")return e;if(e.__type)return b(e);if("$and"in e)return{[d.Op.and]:e.$and.map(r=>x(r))};if("$or"in e)return{[d.Op.or]:e.$or.map(r=>x(r))};if("$not"in e)return{[d.Op.not]:e.$not.map(r=>x(r))};let o={};for(let[r,i]of Object.entries(e))if(typeof i=="object"&&i!==null&&!Array.isArray(i)&&!i.__type)if(Object.keys(i).some(n=>n.startsWith("$")&&n!=="$and"&&n!=="$or"&&n!=="$not")){let n={};for(let[a,c]of Object.entries(i)){let s=b(c);switch(a){case"$eq":n[d.Op.eq]=s;break;case"$ne":n[d.Op.ne]=s;break;case"$is":n[d.Op.is]=s;break;case"$isNot":n[d.Op.isNot]=s;break;case"$not":n[d.Op.not]=s;break;case"$gt":n[d.Op.gt]=s;break;case"$gte":n[d.Op.gte]=s;break;case"$lt":n[d.Op.lt]=s;break;case"$lte":n[d.Op.lte]=s;break;case"$between":n[d.Op.between]=s;break;case"$notBetween":n[d.Op.notBetween]=s;break;case"$in":n[d.Op.in]=s;break;case"$notIn":n[d.Op.notIn]=s;break;case"$all":n[d.Op.all]=s;break;case"$any":n[d.Op.any]=s;break;case"$like":n[d.Op.like]=s;break;case"$notLike":n[d.Op.notLike]=s;break;case"$startsWith":n[d.Op.startsWith]=s;break;case"$endsWith":n[d.Op.endsWith]=s;break;case"$substring":n[d.Op.substring]=s;break;case"$ilike":q().dialect==="postgres"?n[d.Op.iLike]=s:n[d.Op.like]=s;break;case"$notILike":q().dialect==="postgres"?n[d.Op.notILike]=s:n[d.Op.notLike]=s;break;case"$regexp":n[d.Op.regexp]=s;break;case"$notRegexp":n[d.Op.notRegexp]=s;break;case"$iRegexp":q().dialect==="postgres"?n[d.Op.iRegexp]=s:n[d.Op.regexp]=s;break;case"$notIRegexp":q().dialect==="postgres"?n[d.Op.notIRegexp]=s:n[d.Op.notRegexp]=s;break;case"$col":n[d.Op.col]=s;break;case"$match":n[d.Op.match]=s;break;case"$contains":n[d.Op.contains]=s;break;case"$contained":n[d.Op.contained]=s;break;case"$overlap":n[d.Op.overlap]=s;break;default:n[a]=s}}o[r]=n}else o[r]=x(i);else o[r]=b(i);return o}function te(e){return e&&(Array.isArray(e)?e.map(o=>Array.isArray(o)&&o.length===2?[b(o[0]),o[1]]:b(o)):typeof e=="object"&&e!==null&&e.exclude&&Array.isArray(e.exclude)?{exclude:e.exclude.map(o=>b(o))}:e)}function D(e){if(!e)return e;if(Array.isArray(e))return e.map(o=>D(o));if(typeof e=="object"&&e!==null){let o={...e};return o.where!==void 0&&o.where!==null&&(o.where=x(o.where)),o.on!==void 0&&o.on!==null&&(o.on=x(o.on)),o.attributes!==void 0&&o.attributes!==null&&(o.attributes=te(o.attributes)),o.include!==void 0&&o.include!==null&&(o.include=D(o.include)),o.order!==void 0&&o.order!==null&&(o.order=b(o.order)),o.group!==void 0&&o.group!==null&&(o.group=b(o.group)),o}return e}function p(e){if(!e)return{};let o={};return e.where!==void 0&&e.where!==null&&(o.where=x(e.where)),e.include!==void 0&&e.include!==null&&(o.include=D(e.include)),e.order!==void 0&&e.order!==null&&(o.order=b(e.order)),e.group!==void 0&&e.group!==null&&(o.group=b(e.group)),e.limit!==void 0&&e.limit!==null&&(o.limit=e.limit),e.offset!==void 0&&e.offset!==null&&(o.offset=e.offset),e.attributes!==void 0&&e.attributes!==null&&(o.attributes=te(e.attributes)),e.paranoid!==void 0&&e.paranoid!==null&&(o.paranoid=e.paranoid),e.force!==void 0&&e.force!==null&&(o.force=e.force),e.individualHooks!==void 0&&e.individualHooks!==null&&(o.individualHooks=e.individualHooks),q().hoistIncludeOptions&&Ce(o),o}function S(e){return e&&typeof e.toJSON=="function"?{data:e.toJSON()}:{data:e||{}}}function A(e){return e.filter(o=>o!==null&&typeof o=="object").map(S)}async function re(e){let o=l();m(o);let r=e.model,i=p(e.options||{}),t=u().get(r);f(t,r);let n=await t.findAll({...i,mapToModel:!1});return A(n)}async function ie(e){let o=l();m(o);let r=e.model,i=p(e.options||{}),n=u().get(r);f(n,r);let a=await n.findOne(i);return a?S(a):null}async function se(e){let o=l();m(o);let r=e.model,i=e.data||{},t=p(e.options||{}),n=u().get(r);if(f(n,r),Array.isArray(i)){if(i.length===0)throw new Error("Cannot create: data array is empty");let c=await n.bulkCreate(i,t);return A(c)}let a=await n.create(i,t);return S(a)}async function ae(){let e=l();return e&&(await e.close(),_()),{closed:!0}}async function ce(e){let o=l();m(o);let r=e.model,i=p(e.options||{}),a=await u().get(r).count(i);return typeof a=="number"?a:a.at(0).count}async function le(e){let o=l();m(o);let r=e.model,i=e.column,t=p(e.options||{}),a=u().get(r);if(f(a,r),!i)throw new Error("Column name is required for max operation");return await a.max(i,t)}async function de(e){let o=l();m(o);let r=e.model,i=e.column,t=p(e.options||{}),a=u().get(r);if(f(a,r),!i)throw new Error("Column name is required for min operation");return await a.min(i,t)}async function ue(e){let o=l();m(o);let r=e.model,i=e.column,t=p(e.options||{}),a=u().get(r);if(f(a,r),!i)throw new Error("Column name is required for sum operation");return await a.sum(i,t)}async function me(e){let o=l();m(o);let r=e.model,i=e.fields,t=p(e.query||{}),a=u().get(r);if(f(a,r),!i||Object.keys(i).length===0)throw new Error("Fields are required for increment operation");let c=await a.increment(i,t);if(!c||!Array.isArray(c))return[];let s=c[0];return s==null||typeof s=="number"||typeof s=="bigint"?[]:(Array.isArray(s)&&s.length>0&&Array.isArray(s[0])&&(s=s[0]),Array.isArray(s)||(s=[s]),A(s))}async function fe(e){let o=l();m(o);let r=e.model,i=e.fields,t=p(e.query||{}),a=u().get(r);if(f(a,r),!i||Object.keys(i).length===0)throw new Error("Fields are required for decrement operation");let c=await a.decrement(i,t);if(!c||!Array.isArray(c))return[];let s=c[0];return s==null||typeof s=="number"||typeof s=="bigint"?[]:(Array.isArray(s)&&s.length>0&&Array.isArray(s[0])&&(s=s[0]),Array.isArray(s)||(s=[s]),A(s))}async function pe(e){let o=l();m(o);let r=e.model,i=e.data,t=p(e.query||{});if(!i||Object.keys(i).length===0)throw new Error("Data is required for update operation");let a=u().get(r);f(a,r);let s=(await a.update(i,t))[0];return typeof s=="number"?s:0}async function ye(e){let o=l();m(o);let r=e.model,i=u().get(r);f(i,r);let t=e.currentData,n=e.previousData,a=e.primaryKeyValues,c=i.getAttributes?.()??i.rawAttributes??i.modelDefinition?.attributes??{},s=c instanceof Map?new Set(c.keys()):new Set(Object.keys(c));function h(w){let P={};for(let y of Object.keys(w))s.has(y)&&(P[y]=w[y]);return P}let k=h(t),M=n?h(n):null;if(!M||Object.keys(M).length===0){let w=await i.create(k,e.options||{});return{data:w&&w.toJSON()||{},isNewRecord:!0}}else{let w=i.build(k,{isNewRecord:!1});if(M){w._previousDataValues={...M};for(let y of Object.keys(k))w.set(y,k[y],{raw:!0})}return{data:(await w.save(e.options||{})).toJSON(),isNewRecord:!1}}}async function ge(e){let o=l();if(!o)throw new Error("Not connected. Call connect first.");return await o.sync({force:e.force===!0,alter:e.alter===!0}),{synced:!0}}function Te(e){return e&&e[0].toUpperCase()+e.slice(1)}function $e(e){return Object.fromEntries(Object.entries(e||{}).filter(([,o])=>o!=null))}async function he(e){let o=l();m(o);let i=u().get(e.sourceModel);f(i,e.sourceModel);let t=$e(e.primaryKeyValues),n=await i.findOne({where:t});if(!n)return null;let a=`get${Te(e.associationName)}`,c=n[a];if(typeof c!="function")throw new Error(`Association getter "${a}" not found on model "${e.sourceModel}"`);let s=await c.call(n,e.options||{});return s?S(s):null}function Ee(e){return e&&e[0].toUpperCase()+e.slice(1)}function je(e){return Object.fromEntries(Object.entries(e||{}).filter(([,o])=>o!=null))}async function be(e){let o=l();m(o);let i=u().get(e.sourceModel);f(i,e.sourceModel);let t=je(e.primaryKeyValues),n=await i.findOne({where:t});if(!n)throw new Error(`Cannot set belongsTo association: instance of "${e.sourceModel}" not found for provided primary key values`);let a=`set${Ee(e.associationName)}`,c=n[a];if(typeof c!="function")throw new Error(`Association setter "${a}" not found on model "${e.sourceModel}"`);let s={...e.options||{}};return e.save!==void 0&&e.save!==null&&(s.save=e.save),await c.call(n,e.targetOrKey,s),{set:!0}}function De(e){return e&&e[0].toUpperCase()+e.slice(1)}function Je(e){return Object.fromEntries(Object.entries(e||{}).filter(([,o])=>o!=null))}async function ke(e){let o=l();m(o);let i=u().get(e.sourceModel);f(i,e.sourceModel);let t=Je(e.primaryKeyValues),n=await i.findOne({where:t});if(!n)throw new Error(`Cannot create belongsTo association: instance of "${e.sourceModel}" not found for provided primary key values`);let a=`create${De(e.associationName)}`,c=n[a];if(typeof c!="function")throw new Error(`Association creator "${a}" not found on model "${e.sourceModel}"`);let s=await c.call(n,e.data||{},e.options||{});return S(s)}async function we(e){let o=l();m(o);let r=e.model,t=u().get(r);f(t,r);let n=p(e.options||{}),a=await t.destroy(n);return typeof a=="number"?a:0}async function Me(e){let o=l();m(o);let r=e.model,t=u().get(r);f(t,r);let n={...e.options||{}};if(q().dialect==="postgres"&&n.cascade){let s=["TRUNCATE TABLE",`"${t.table?.tableName??t.tableName??r}"`];n.restartIdentity&&s.push("RESTART IDENTITY"),s.push("CASCADE"),await o.query(s.join(" "));return}n.cascade&&n.withoutForeignKeyChecks===void 0&&(n.withoutForeignKeyChecks=!0),await t.truncate(n)}async function qe(e){let o=l();m(o);let r=e.model,t=u().get(r);f(t,r);let n=p(e.options||{});await t.restore(n)}async function Re(e){let o=l();m(o);let r=e.model,i=e.primaryKeyValues,n=u().get(r);f(n,r);let a=n.build(i,{isNewRecord:!1}),c=e.options||{};await a.destroy(c)}async function Se(e){let o=l();m(o);let r=e.model,i=e.primaryKeyValues,n=u().get(r);f(n,r),await n.build(i,{isNewRecord:!1}).restore()}async function Ae(e){let o=l();m(o);let r=e.options||{};await o.truncate(r)}async function Oe(e){let o=l();m(o);let r=e.options||{};await o.destroyAll(r)}async function J(e,o){let{id:r,method:i,params:t}=e;try{let n;switch(i){case"ready":n=await Q();break;case"connect":n=await Y(t);break;case"defineModel":n=await ee(t);break;case"associateModel":n=await ne(t);break;case"findAll":n=await re(t);break;case"findOne":n=await ie(t);break;case"create":n=await se(t);break;case"count":n=await ce(t);break;case"max":n=await le(t);break;case"min":n=await de(t);break;case"sum":n=await ue(t);break;case"increment":n=await me(t);break;case"decrement":n=await fe(t);break;case"update":n=await pe(t);break;case"save":n=await ye(t);break;case"sync":n=await ge(t);break;case"belongsToGet":n=await he(t);break;case"belongsToSet":n=await be(t);break;case"belongsToCreate":n=await ke(t);break;case"destroy":n=await we(t);break;case"truncate":n=await Me(t);break;case"restore":n=await qe(t);break;case"instanceDestroy":n=await Re(t);break;case"instanceRestore":n=await Se(t);break;case"sequelizeTruncate":n=await Ae(t);break;case"sequelizeDestroyAll":n=await Oe(t);break;case"close":n=await ae();break;default:throw new Error(`Unknown method: ${i}`)}o({id:r,result:n})}catch(n){o({id:r,error:K(n)})}}async function B(){let e=l();e&&await e.close()}var Ne=require("util"),xe=C.parentPort!==null;function L(e,o){let r=(0,Ne.format)(...o),i={notification:"log",level:e,message:r};xe?C.parentPort.postMessage(i):process.stdout.write(JSON.stringify(i)+`
`)}console.log=(...e)=>L("log",e);console.info=(...e)=>L("info",e);console.warn=(...e)=>L("warn",e);var N;if(xe){let e=C.parentPort;N=o=>{e.postMessage(o)},E(o=>{e.postMessage(o)}),e.postMessage({id:0,result:{ready:!0}}),e.on("message",async o=>{await J(o,N)}),e.on("close",async()=>{await B()}),process.on("uncaughtException",o=>{e.postMessage({id:null,error:{message:`Uncaught exception: ${o.message}`,stack:o.stack}})}),process.on("unhandledRejection",o=>{e.postMessage({id:null,error:{message:`Unhandled rejection: ${o?.message||o}`,stack:o?.stack}})})}else{N=r=>{process.stdout.write(JSON.stringify(r)+`
`)},E(r=>{process.stdout.write(JSON.stringify(r)+`
`)}),N({id:0,result:{ready:!0}});let e="";process.stdin.setEncoding("utf8"),process.stdin.on("data",r=>{e+=r;let i=e.split(`
`);e=i.pop()||"";for(let t of i)if(t.trim())try{let n=JSON.parse(t);J(n,N).catch(a=>{N({id:n.id||null,error:{message:`Handler error: ${a.message}`,stack:a.stack}})})}catch(n){N({id:null,error:{message:`Parse error: ${n.message}`,code:-32700}})}});async function o(){await B(),process.exit(0)}process.stdin.on("end",()=>{o().catch(()=>process.exit(0))}),process.on("SIGTERM",()=>{o().catch(()=>process.exit(0))}),process.on("SIGINT",()=>{o().catch(()=>process.exit(0))})}
